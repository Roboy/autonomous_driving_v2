
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>steering_helper &#8212; beginner_tutorials 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for steering_helper</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">    target_angle_listener = TargetAngleListener()</span>
<span class="sd">    target_angle_listener.start()</span>

<span class="sd">    actual_angle_listener = AngleSensorListener()</span>
<span class="sd">    actual_angle_listener.start()</span>

<span class="sd">    actual_angle = actual_angle_listener.get_latest_actual_angle()</span>
<span class="sd">    target_angle = target_angle_listener.get_latest_target_angle()</span>

<span class="sd">    Parameters:</span>
<span class="sd">    wheel_base - double, distance between the wheels of the model.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">atan</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">floor</span>

<span class="kn">from</span> <span class="nn">roboy_middleware_msgs.msg</span> <span class="k">import</span> <span class="n">MotorCommand</span><span class="p">,</span> <span class="n">MotorAngle</span><span class="p">,</span> <span class="n">MotorConfig</span>
<span class="kn">from</span> <span class="nn">roboy_middleware_msgs.srv</span> <span class="k">import</span> <span class="n">MotorConfigService</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="k">import</span> <span class="n">Twist</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="k">import</span> <span class="n">Float32</span>

<span class="n">MOTOR_CONTROL_POSITION</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">MOTOR_CONTROL_VELOCITY</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">MOTOR_CONTROL_DISPLACEMENT</span> <span class="o">=</span> <span class="mi">2</span>

<div class="viewcode-block" id="rad_to_deg"><a class="viewcode-back" href="../steering_helper.html#steering_helper.rad_to_deg">[docs]</a><span class="k">def</span> <span class="nf">rad_to_deg</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts angle from radian to degree</span>
<span class="sd">    :param val: angle in radian</span>
<span class="sd">    :type val: float</span>

<span class="sd">    :returns: angle in degree (float)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">val</span> <span class="o">/</span> <span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span></div>


<div class="viewcode-block" id="deg_to_rad"><a class="viewcode-back" href="../steering_helper.html#steering_helper.deg_to_rad">[docs]</a><span class="k">def</span> <span class="nf">deg_to_rad</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts angle from degree to radian</span>
<span class="sd">    :param val: angle in degree</span>
<span class="sd">    :type val: float</span>

<span class="sd">    :returns: angle in radian (float)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">val</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">pi</span></div>

<div class="viewcode-block" id="convert_trans_rot_vel_to_steering_angle"><a class="viewcode-back" href="../steering_helper.html#steering_helper.convert_trans_rot_vel_to_steering_angle">[docs]</a><span class="k">def</span> <span class="nf">convert_trans_rot_vel_to_steering_angle</span><span class="p">(</span><span class="n">lin_vel</span><span class="p">,</span> <span class="n">ang_vel</span><span class="p">,</span> <span class="n">wheelbase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms the rotational velocity command from the cmd_vel message and turns it into a steering angle</span>
<span class="sd">    Taken from http://docs.ros.org/kinetic/api/teb_local_planner/html/cmd__vel__to__ackermann__drive_8py_source.html</span>

<span class="sd">    :param lin_vel: forward velocity of the bike (is set to 1 per default) (m/s)</span>
<span class="sd">    :type lin_vel: float</span>
<span class="sd">    :param ang_vel: angular velocity of the cmd_vel message</span>
<span class="sd">    :type ang_vel: float</span>
<span class="sd">    :param wheelbase: distance between front and back axis of the rickshaw (meter)</span>
<span class="sd">    :type wheelbase: float</span>

<span class="sd">    :returns: steering angle in radian (float)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ang_vel</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lin_vel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">radius</span> <span class="o">=</span> <span class="n">lin_vel</span> <span class="o">/</span> <span class="n">ang_vel</span>
    <span class="k">return</span> <span class="n">atan</span><span class="p">(</span><span class="n">wheelbase</span> <span class="o">/</span> <span class="n">radius</span><span class="p">)</span></div>


<div class="viewcode-block" id="TargetAngleListener"><a class="viewcode-back" href="../steering_helper.html#steering_helper.TargetAngleListener">[docs]</a><span class="k">class</span> <span class="nc">TargetAngleListener</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; This Class contains a ROS-node that subscribes to the cmd_vel for the rickshaw. Passes extracted steering angle to the high-level controller.</span>
<span class="sd">    Usage:</span>
<span class="sd">    This class is used in the steering_controller.py file and acts as an interface between cmd_vel and the high-level controller.</span>
<span class="sd">    INFO: This class was mainly written by AD in WiSe18/19 and this documentation was completed by AD2 in SuSe19, therefore documentation may differ from actual functionality.</span>
<span class="sd">    </span>
<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    target_angle : float</span>
<span class="sd">        radian value of target steering angle</span>
<span class="sd">    wheel_base : float</span>
<span class="sd">        distance</span>

<span class="sd">    Methods</span>
<span class="sd">    ----------</span>
<span class="sd">    start()</span>
<span class="sd">        starts the subscriber</span>
<span class="sd">    listen_to_navigation_controller()</span>
<span class="sd">        subscriber for target angle, converts Twist to angle.</span>
<span class="sd">    get_latest_target_angle()</span>
<span class="sd">        gives back last known target angle (radian).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_angle</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="TargetAngleListener.start"><a class="viewcode-back" href="../steering_helper.html#steering_helper.TargetAngleListener.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets ROS-param and start the subscriber.</span>
<span class="sd">        :returns: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wheel_base</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s1">&#39;~wheel_base&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listen_to_navigation_controller</span><span class="p">()</span></div>

<div class="viewcode-block" id="TargetAngleListener.listen_to_navigation_controller"><a class="viewcode-back" href="../steering_helper.html#steering_helper.TargetAngleListener.listen_to_navigation_controller">[docs]</a>    <span class="k">def</span> <span class="nf">listen_to_navigation_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscriber for the target angle</span>
<span class="sd">        :returns: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">navigation_commands_receiver</span><span class="p">(</span><span class="n">twist</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Callback function for the subscriber.</span>
<span class="sd">            Converts Twist to radian angle</span>
<span class="sd">            :param twist: Twist message with the cmd_vel</span>
<span class="sd">            :type twist: Twist</span>
<span class="sd">            </span>
<span class="sd">            :returns: nothing</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">angular_velocity</span> <span class="o">=</span> <span class="n">twist</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span>
            <span class="n">linear_velocity</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_angle</span> <span class="o">=</span> <span class="n">convert_trans_rot_vel_to_steering_angle</span><span class="p">(</span>
                <span class="n">linear_velocity</span><span class="p">,</span> <span class="n">angular_velocity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel_base</span>
            <span class="p">)</span>

        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;/cmd_vel&#39;</span><span class="p">,</span> <span class="n">Twist</span><span class="p">,</span> <span class="n">navigation_commands_receiver</span><span class="p">)</span></div>

<div class="viewcode-block" id="TargetAngleListener.get_latest_target_angle"><a class="viewcode-back" href="../steering_helper.html#steering_helper.TargetAngleListener.get_latest_target_angle">[docs]</a>    <span class="k">def</span> <span class="nf">get_latest_target_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter for target angle</span>
<span class="sd">        :returns: last send target angle in radian (float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_angle</span></div></div>


<div class="viewcode-block" id="AngleSensorListener"><a class="viewcode-back" href="../steering_helper.html#steering_helper.AngleSensorListener">[docs]</a><span class="k">class</span> <span class="nc">AngleSensorListener</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; This Class contains a ROS-node that subscribes to the processed angle value of the rickshaw and smoothes it out. Passes the smooth angle to the high-level controller.</span>
<span class="sd">    Usage:</span>
<span class="sd">    This class is used in the steering_controller.py file and acts as an interface between unfiltered angle data and the high-level controller.</span>
<span class="sd">    INFO: This class was mainly written by AD in WiSe18/19 and this documentation was completed by AD2 in SuSe19, therefore documentation may differ from actual functionality.</span>
<span class="sd">    </span>
<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    actual_angle : float</span>
<span class="sd">        radian value of the unfiltered angle data</span>
<span class="sd">    smmoth_angle : float</span>
<span class="sd">        filtered angle data (radian)</span>
<span class="sd">    last_smooth_angle : float</span>
<span class="sd">        is only updated if a certain threshold is crossed</span>
<span class="sd">    decay : float</span>
<span class="sd">        parameter for smoothing</span>
<span class="sd">    threshold : float</span>
<span class="sd">        parameter for updating last_smooth_angle</span>

<span class="sd">    Methods</span>
<span class="sd">    ----------</span>
<span class="sd">    start()</span>
<span class="sd">        starts the subscriber</span>
<span class="sd">    listen_to_angle_sensor()</span>
<span class="sd">        subcriber for target angle</span>
<span class="sd">    get_latest_actual_angle()</span>
<span class="sd">        gives back last known steering angle, not processed (radian).</span>
<span class="sd">    get_latest_smooth_angle()</span>
<span class="sd">        gives back last known steering angle (radian).</span>
<span class="sd">    smooth_out()</span>
<span class="sd">        reduces the impact of noise on the angle data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">decay</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> 
                 <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">pi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param decay: smooth_angle is computed as</span>
<span class="sd">                      angle = decay*angle + (1-decay)*new_angle</span>
<span class="sd">        :type decay: float</span>
<span class="sd">        :param threshold: smooth_angle is updated if difference between the new</span>
<span class="sd">                          and the last value is larger than the provided</span>
<span class="sd">                          threshold.</span>
<span class="sd">        :tpye thrshold: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actual_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_smooth_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay</span> <span class="o">=</span> <span class="n">decay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>

<div class="viewcode-block" id="AngleSensorListener.start"><a class="viewcode-back" href="../steering_helper.html#steering_helper.AngleSensorListener.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        starts the subscriber</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listen_to_angle_sensor</span><span class="p">()</span></div>

<div class="viewcode-block" id="AngleSensorListener.listen_to_angle_sensor"><a class="viewcode-back" href="../steering_helper.html#steering_helper.AngleSensorListener.listen_to_angle_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">listen_to_angle_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ROS-subscriber for the unfiltered angle data</span>
<span class="sd">        :returns: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">angle_receiver</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Callback function for the subcriber, filters the angle data and updates the attributes.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actual_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">angle</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smooth_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_out</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">angle</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smooth_angle</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_smooth_angle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_smooth_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_angle</span>

        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;/roboy/middleware/RickshawAngle&#39;</span><span class="p">,</span> <span class="n">Float32</span><span class="p">,</span>
                         <span class="n">angle_receiver</span><span class="p">)</span></div>

<div class="viewcode-block" id="AngleSensorListener.get_latest_actual_angle"><a class="viewcode-back" href="../steering_helper.html#steering_helper.AngleSensorListener.get_latest_actual_angle">[docs]</a>    <span class="k">def</span> <span class="nf">get_latest_actual_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Last known steering angle, not processed.</span>
<span class="sd">        :returns: unfiltered angle (radian, float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual_angle</span></div>

<div class="viewcode-block" id="AngleSensorListener.get_latest_smooth_angle"><a class="viewcode-back" href="../steering_helper.html#steering_helper.AngleSensorListener.get_latest_smooth_angle">[docs]</a>    <span class="k">def</span> <span class="nf">get_latest_smooth_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Last known steering angle.</span>
<span class="sd">        Smoothed using the exponential smoothing</span>
<span class="sd">        https://en.wikipedia.org/wiki/Exponential_smoothing</span>
<span class="sd">        to filter out the noise.</span>
<span class="sd">        :returns: last_smooth_angle (radian, float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_smooth_angle</span></div>

<div class="viewcode-block" id="AngleSensorListener.smooth_out"><a class="viewcode-back" href="../steering_helper.html#steering_helper.AngleSensorListener.smooth_out">[docs]</a>    <span class="k">def</span> <span class="nf">smooth_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduced the impact of noise by filtering the data</span>
<span class="sd">        :param angle: current unfiltered angle data (radian)</span>
<span class="sd">        :type angle: float</span>
<span class="sd">    </span>
<span class="sd">        :returns: filtered angle (radian, float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_angle</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">)</span> <span class="o">*</span> <span class="n">angle</span></div></div>


<div class="viewcode-block" id="MyoMuscleController"><a class="viewcode-back" href="../steering_helper.html#steering_helper.MyoMuscleController">[docs]</a><span class="k">class</span> <span class="nc">MyoMuscleController</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; This Class contains a ROS-node that configures the myo-muscles and sends commands to them</span>
<span class="sd">    Usage:</span>
<span class="sd">    This Class is used in the steering_controller.py file and acts as an interface between high-level steering-controller and low-level myo-muscle controller.</span>
<span class="sd">    </span>
<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    fpga_id : int</span>
<span class="sd">        id of the fpga the myo-muscle is connected to</span>
<span class="sd">    motor_id : int</span>
<span class="sd">        id of the slave-select pin the motor is connected to on the FPGA (check wiring).</span>
<span class="sd">    init_disp : int</span>
<span class="sd">        default displacement values the motor is set to after configuring them</span>

<span class="sd">    Methods</span>
<span class="sd">    ----------</span>
<span class="sd">    start()</span>
<span class="sd">        starts the publisher and configures the myo-muscle</span>
<span class="sd">    set_control_mode()</span>
<span class="sd">       configures the myo-muscle</span>
<span class="sd">    send_command()</span>
<span class="sd">        sends the displacement command from the controller to the myo-muscle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpga_id</span><span class="p">,</span> <span class="n">motor_id</span><span class="p">,</span> <span class="n">init_disp</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param fpga_id: id of the fpga the myo-muscle is connected to</span>
<span class="sd">        :type fpga_id: int</span>
<span class="sd">        :param motor_id: id of the slave-select pin the myo-muscle is connected to on the fpga</span>
<span class="sd">        :type motor_id: int</span>
<span class="sd">        :param init_disp: default displacment values the motor is set to after configuring them</span>
<span class="sd">        :type init_disp: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fpga_id</span> <span class="o">=</span> <span class="n">fpga_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motor_id</span> <span class="o">=</span> <span class="n">motor_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_disp</span> <span class="o">=</span> <span class="n">init_disp</span>

<div class="viewcode-block" id="MyoMuscleController.start"><a class="viewcode-back" href="../steering_helper.html#steering_helper.MyoMuscleController.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        starts the publisher for the motor command.</span>
<span class="sd">        Call the initial configurment of the myo-muscle</span>
<span class="sd">        :returns: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;/roboy/middleware/MotorCommand&#39;</span><span class="p">,</span>
                                         <span class="n">MotorCommand</span><span class="p">,</span>
                                         <span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="s1">&#39;CAREFUL! Myo-muscle controller is activated, &#39;</span>
                      <span class="s1">&#39;rickshaw will start turning if cmd_vel command is set.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">()</span></div>

<div class="viewcode-block" id="MyoMuscleController.set_control_mode"><a class="viewcode-back" href="../steering_helper.html#steering_helper.MyoMuscleController.set_control_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the ROS-service that configures the myo-muscle</span>
<span class="sd">        :returns: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#config_motors_service = rospy.ServiceProxy(</span>
        <span class="c1">#    &#39;/roboy/rikshaw/middleware/MotorConfig&#39;,</span>
        <span class="c1">#    MotorConfigService</span>
        <span class="c1">#)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">MotorConfig</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fpga_id</span><span class="p">,</span>
            <span class="n">motors</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">motor_id</span><span class="p">],</span>
            <span class="n">control_mode</span><span class="o">=</span><span class="p">[</span><span class="n">MOTOR_CONTROL_DISPLACEMENT</span><span class="p">],</span>
            <span class="n">output_pos_max</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">],</span>
            <span class="n">output_neg_max</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">],</span>
            <span class="n">sp_pos_max</span><span class="o">=</span><span class="p">[</span><span class="mi">1000000</span><span class="p">],</span>
            <span class="n">sp_neg_max</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1000000</span><span class="p">],</span>
            <span class="n">integral_pos_max</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">],</span>
            <span class="n">integral_neg_max</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">],</span>
            <span class="n">kp</span><span class="o">=</span><span class="p">[</span><span class="mi">200</span><span class="p">],</span>
            <span class="n">ki</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">kd</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">forward_gain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">dead_band</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">output_divider</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">setpoint</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">init_disp</span><span class="p">]</span>
        <span class="p">)</span></div>
        <span class="c1">#config_motors_service(config)</span>

<div class="viewcode-block" id="MyoMuscleController.send_command"><a class="viewcode-back" href="../steering_helper.html#steering_helper.MyoMuscleController.send_command">[docs]</a>    <span class="k">def</span> <span class="nf">send_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">effort</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends displacment commands via ROS-message to the fpga</span>
<span class="sd">        :param effort: displacement the myo-muscle should reach</span>
<span class="sd">        :type effort: int</span>
<span class="sd">        </span>
<span class="sd">        :returns: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">MotorCommand</span><span class="p">()</span>
        <span class="n">command</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpga_id</span>
        <span class="n">command</span><span class="o">.</span><span class="n">motors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">motor_id</span><span class="p">]</span>
        <span class="n">command</span><span class="o">.</span><span class="n">set_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">effort</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">beginner_tutorials</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, DominikMuhle.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>